# Baby Metrics Tracker – Phase-by-Phase Development Plan (Revised v0.3)

This document revises the architect's original plan to plug a few missed PRD items, tighten security & quality controls, and add a lightweight timeline so stakeholders can understand when to expect each milestone.

## 0. Foundation & Cross-Cutting Concerns (applies to all phases)

| Concern                | Decision                                                                                                                         | Rationale / Delta from v0.2                                                                           |
| ---------------------- | -------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- |
| **Language**           | TypeScript (strict) everywhere                                                                                                   | Unchanged. 100% JS ecosystem with the safety net.                                                     |
| **Monorepo tooling**   | pnpm + Turborepo                                                                                                                 | Faster CI, workspace-level caching, easy per-package builds.                                          |
| **Frameworks**         | React 18 web (Vite) • React Native + Expo (mobile)                                                                               | Unchanged.                                                                                            |
| **State Mgmt**         | Zustand + React Query                                                                                                            | Adds React Query to de-duplicate remote fetch + cache and drive suspense.                             |
| **I18n**               | i18next + react-i18next                                                                                                          | Same libs, plus: language auto-detect via navigator.language, remembers preference in secure storage. |
| **Analytics**          | Segment (write-key in env) → Product-Analytics destination                                                                       | Matches PRD §9; free tier is enough for hobby scope.                                                  |
| **Testing**            | Unit / Integration → Vitest • Component → Storybook + @storybook/testing-react • End-to-End → Playwright (web) & Detox (RN)      | Adds Storybook for visual regression & Playwright for P95 latency budget.                             |
| **Lint / Format**      | ESLint (airbnb-base + @typescript-eslint) • Prettier • Husky + lint-staged                                                       | Blocks bad code before CI.                                                                            |
| **CI/CD**              | GitHub Actions → (1) test & lint (2) deploy preview (Vercel / Cloudflare Pages) (3) Supabase CLI migration • Expo EAS (mobile)   | No manual steps; every PR = shareable preview.                                                        |
| **Security & Privacy** | Supabase row-level security policies • Column-level encryption for sensitive data • All traffic TLS 1.3 • Keys in GitHub Secrets | Addresses PRD §8 (AES-256 at rest, COPPA mitigation). No child PII beyond first name.                 |
| **Monitoring / Crash** | Sentry (browser + RN) • Web Vitals → Vercel Analytics                                                                            | Same as v0.2.                                                                                         |
| **Docs**               | Docusaurus site in /docs • ERD generated by pg-modeler GitHub Action                                                             | Live, versioned documentation.                                                                        |
| **Dev Bootstrap**      | `pnpm i && pnpm dev` spins local Supabase + Vite + Expo + Storybook                                                              | Single-command setup goal.                                                                            |

## Phase 1 — Browser Proof-of-Concept (≈ 2 weeks)

**Exit Criteria (unchanged):** Wife + two in-laws log a full week with zero data loss, informal SUS ≥ 80, no backend yet.

### Scope Additions / Fixes

- **Accessibility baseline (WCAG 2.2 AA)** – run Axe audits in CI, high-contrast colour palette verified.
- **Performance Budget** – Lighthouse CI gate: P95 interaction time < 150 ms on Moto G 4.
- **Instrumentation** – Segment context + track("Entry Added") etc.; metrics flushed to localStorage if offline.

### Technical Notes (delta-only)

- Swap custom IDB wrapper for Dexie (battle-tested ≈ less maintenance).
- Add Storybook: document EntryForm, TimelineChart, QuickAddButton.
- Service Worker now caches translation JSON & Segment queue as well.

Phase 2 — Cloud MVP (≈ 4 weeks following Phase 1 sign‑off)

Exit Criteria (same): 30 day family trial; ≤ 5 entries/day; backend error < 1 %; wife sign‑off.

Backend Enhancements

Service

Implementation Updates

Auth

Magic‑link via Supabase, plus optional Apple/Google OAuth (zero‑password option is friendlier for grandparents).

DB

Postgres tables mirror Phase 1; add unique composite index (baby_id, created_at) to avoid dupes; all tables deleted_at soft‑delete column for audit.

Row‑Level Security

Example policy: create policy "Baby owners" on entry for all using (exists (select 1 from caregiver_relationship where caregiver_id = auth.uid() and baby_id = entry.baby_id));

Realtime

Supabase Realtime Channels (baby:{id}) – events broadcast after commit.

Edge Functions

Split into micro‑functions: /export/csv, /alert/feeding‑gap, /segment/forward (to keep key secret).

Storage

Move PDF exports to Supabase Storage private bucket; signed URLs expire 24 h.

Front‑End Upgrades

Replace IndexedDB layer with Supabase Offline Sync (experimental) if stable; else keep Dexie queue.

React Query handles optimistic UI + rollback on error.

Notifications: browsers via Service Worker; email via Supabase SMTP extension.

Gamified streaks widget (PRD Risk – caregiver fatigue).

Quality Gates

Automated load test with k6 (GitHub Action) – 5 rps for 15 min, error < 0.5 %.

E2E Playwright scenarios on PR: happy path feed/diaper/sleep.

Phase 3 — Side‑Loaded Mobile App (≈ 3 weeks)

Criteria unchanged • all caregivers install the build; internal survey ≥ 4.5/5.

Notable Deltas

Offline Sync – use supabase‑react‑native + queued mutation store (same algorithm as web) to share code.

Biometric Login – Face ID / Android BiometricPrompt via Expo LocalAuth.

Deep Links – babymetrics://entry?type=feed for quick add from iOS widgets.

Observability – Sentry + Expo Updates release channel family‑prod; crash‑free users KPI in dashboard.

Phase 4 — Hardening & Polish (≈ 2 weeks, parallel bug‑fix runway)

Track

Activities

Security

Quarterly OWASP ZAP scan, dependency review via Snyk GitHub App.

Accessibility

Manual screen‑reader pass (NVDA, VoiceOver).

Docs & Handoff

Generate PDF quick‑start guide (EN/简体中文) for caregivers; architectural decision records (ADR) committed to repo.

Backup & Restore

Automate Supabase scheduled export + upload to family iCloud/Google Drive.

Timeline Overview (calendar‑time, sequential)

Phase

Duration

Target Dates\*

P0 – Project bootstrap

3 days

Jul 1‑3 2025

P1 – Browser POC

2 weeks

Jul 4‑17 2025

Buffer / Feedback #1

3 days

Jul 18‑20 2025

P2 – Cloud MVP

4 weeks

Jul 21‑Aug 17 2025

Buffer / Feedback #2

1 week

Aug 18‑24 2025

P3 – Mobile

3 weeks

Aug 25‑Sep 14 2025

P4 – Hardening

2 weeks

Sep 15‑28 2025

\*Dates assume kick‑off on July 1 2025 and one full‑time developer. Adjust if capacity differs.

Change‑Log vs. Architect Draft

Added Segment analytics & Playwright/Detox tests to fulfill PRD §9 and tighten quality.

Introduced Storybook to catch UI regressions and aid multilingual copy reviews.

Explicit accessibility & performance budgets to meet PRD non‑functional requirements.

Row‑level security example policy + encryption note for privacy compliance.

Timeline & buffers for realistic expectation‑setting.

Developer‑experience tweaks (pnpm/Turborepo, Husky) to keep the codebase healthy.

Next Steps

Confirm timeline with the team (capacity & vacations).

Align on Supabase paid tier (free may throttle Realtime at > 500 concurrent connections).

Spin up main branch with monorepo scaffolding & CI skeleton.

Start Phase 1 sprint planning.
